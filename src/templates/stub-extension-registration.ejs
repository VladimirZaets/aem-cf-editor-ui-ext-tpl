/*
 * <license header>
 */
import { Text } from "@adobe/react-spectrum"
import { register } from "@adobe/uix-guest"
import { extensionId } from "./Constants"
<%_ if (extensionManifest.isDemoExtension) { -%>
<%- include(extensionManifest.templateFolder + '/rte-getCustomButtons') -%>
<%_ } -%>

function ExtensionRegistration() {
  const init = async () => {
    const guestConnection = await register({
      id: extensionId,
      methods: {
        <%_ if (extensionManifest.headerMenuButtons) { -%>
        headerMenu: {
          getButtons() {
            return [
              // YOUR HEADER BUTTONS CODE SHOULD BE HERE
              <%_ extensionManifest.headerMenuButtons.forEach((button) => { -%>
              {
                'id': '<%- button.id %>',
                'label': '<%- button.label %>',
                'icon': 'OpenIn',
                onClick() {
                  <%_ if (button.needsModal) { -%>
                  const modalURL = "/index.html#/<%- button.id %>-modal";
                  console.log("Modal URL: ", modalURL);

                  guestConnection.host.modal.showUrl({
                    title: "<%- button.label %>",
                    url: modalURL,
                  });
                  <%_ } -%>
                },
              },
              <%_ }) -%>
            ];
          },
        },
        <%_ } -%> <%# end of: if (extensionManifest.headerMenuButtons) %>
        <%_ if (extensionManifest.isDemoExtension) { -%>
        rte: {
<%- include(extensionManifest.templateFolder + '/rte-getCustomButtons') -%>
        }
        <%_ } -%>
      }
    })
  }
  init().catch(console.error)

  return <Text>IFrame for integration with Host (AEM)...</Text>;
}

export default ExtensionRegistration;
